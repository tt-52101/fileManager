<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="./pdfjs-2.0.943-dist/build/pdf.js"></script>
    <title>Document</title>
</head>
<body>
    <span>test.txt</span>
    <p id="txtContent"></p>
    <a href="http://localhost:8000/test">XX</a>
    <a href="/fm/pdfjs-2.0.943-dist/web/viewer.html?file=compressed.tracemonkey-pldi-09.pdf">Open yourpdf.pdf with PDF.js</a>
    <div>
    <canvas id="the-canvas" style="border:1px  solid black"></canvas>
    </div>
    

</body>
<script>
    // 不用浏览器打开txt，直接用 html5 的 filereader 
//     $(document).ready(function(){
//         console.log("ready");
//         $("span").click(function(){
//             console.log("click");
//             xhrfunction();
//         });
//     });

// function xhrfunction(){ 
// 	console.log("xhrfunction");
//         var url="http://localhost:8000/test";
//         var xhr=new XMLHttpRequest();
//         xhr.open('GET',url,true);
//         xhr.responseType="blob";
//         xhr.send();
//         xhr.onreadystatechange = function () {            
//             if (this.readyState == 4 && this.status == 200) {
//             	console.log('DONE', xhr.readyState); // readyState 为 4
//                  myFunction(this);               
//             }
//         };
// };    

// function myFunction(_this){
//     var file_blob=new Blob(); 
//     file_blob=_this.response;
//     var reader = new FileReader();
//     reader.readAsText(file_blob);
//     reader.onload=function(){
//         document.getElementById("txtContent").innerHTML = this.result;
//         console.log(this.result);//当读取完成之后会回调这个函数，然后此时文件的内容存储到了result中。直接操作即可。
//     }
    
// }




//
  // If absolute URL from the remote server is provided, configure the CORS
  // header on that server.
  //
//  var url = "./pdfjs-2.0.943-dist/web/compressed.tracemonkey-pldi-09.pdf";
  var url = "http://localhost:8000/test";
  //
  // The workerSrc property shall be specified.
 
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    './pdfjs-2.0.943-dist/build/pdf.worker.js';
  //
  // Asynchronous download of PDF
var loadingTask = pdfjsLib.getDocument(url);
loadingTask.promise.then(function(pdf) {
  console.log('PDF loaded');
  
  // Fetch the first page
  var pageNumber = 1;
  pdf.getPage(pageNumber).then(function(page) {
    console.log('Page loaded');
    //scale 
    //放缩比例
    //也影响canvas size
    var scale = 1.5;
    var viewport = page.getViewport(scale);

    // Prepare canvas using PDF page dimensions
    var canvas = document.getElementById('the-canvas');
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    // Render PDF page into canvas context
    var renderContext = {
      canvasContext: context,
      viewport: viewport
    };
    var renderTask = page.render(renderContext);
    renderTask.promise.then(function () {
      console.log('Page rendered');
    });
  });
}, function (reason) {
  // PDF loading error
  console.error(reason);
});
</script>

</html>